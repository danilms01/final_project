---
import Layout from '../layouts/Layout.astro';
import Button from '../components/Button.astro';
import Hero from '../components/Hero.astro';
---

<Layout 
  title="Check Gift Card Balance - Anejo Mexican Restaurant"
  description="Check your Anejo gift card balance and view transaction history. Track your remaining balance and recent purchases."
>
  <Hero 
    title="Gift Card Balance"
    subtitle="Check your gift card balance and view your transaction history."
    imageSrc="https://img-us.didaudo.net/us-locations/CA/000/013/13824/0anejo-restaurant.jpg?output=webp&fit=cover&w=800&h=600&q=70"
  />

  <section class="py-16 bg-white">
    <div class="container mx-auto px-4 flex flex-col items-center"> {/* Centering the content */}
      <div class="text-center mb-12 max-w-4xl">
        <h2 class="font-display text-3xl font-bold text-secondary-800 mb-4">Check Your Balance</h2>
        <p class="text-secondary-600 text-lg max-w-2xl mx-auto">
          Enter your gift card number below to check your current balance and view your transaction history.
        </p>
      </div>

      <div class="grid md:grid-cols-5 gap-8 w-full max-w-4xl"> {/* Ensuring the grid takes available width up to max-w-4xl */}
        <div class="md:col-span-2">
          <form id="balance-form" class="bg-secondary-50 rounded-lg p-6 shadow-md">
            <div class="mb-6">
              <label for="card-number" class="block text-secondary-700 font-medium mb-2">Gift Card Number</label>
              <input 
                type="text" 
                id="card-number" 
                name="card-number" 
                placeholder="Enter 16-digit card number"
                pattern="[0-9]{16}"
                maxlength="16"
                required
                class="w-full rounded-md border-secondary-300 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50"
              />
              <p class="text-xs text-secondary-500 mt-1">
                The 16-digit number printed on the back of your physical card or included in your digital gift card email.
              </p>
            </div>

            <div class="mt-8">
              <Button type="submit" variant="primary" fullWidth={true}>
                Check Balance
              </Button>
            </div>
          </form>

          <div class="mt-8 bg-secondary-50 rounded-lg p-6 shadow-md">
            <h3 class="font-display text-xl font-semibold text-secondary-800 mb-4">Need Help?</h3>
            <p class="text-secondary-600 mb-4">
              If you're having trouble with your gift card or have questions about your balance, our team is here to help.
            </p>
            <a href="#" class="inline-flex items-center text-primary-600 hover:text-primary-700 font-medium">
              Contact Customer Support
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </a>
          </div>
        </div>

        <!-- Updated Image Section -->
        <div class="md:col-span-2 flex items-center justify-center"> {/* Changed from md:col-span-1 to md:col-span-2 */}
          <img 
            src="https://c8.alamy.com/comp/2B2A597/icon-for-balance-check-balance-2B2A597.jpg" 
            alt="Check Balance Icon" 
            class="rounded-lg shadow-md w-full h-auto object-contain max-h-[900px]"
          />
        </div>

        <div id="balance-results" class="md:col-span-1 hidden"> {/* Adjusted from md:col-span-2 to md:col-span-1 */}
          <div class="bg-white border border-secondary-200 rounded-lg shadow-md overflow-hidden">
            <div class="bg-primary-600 py-4 px-6">
              <h3 class="text-white font-display text-xl font-semibold">Gift Card Details</h3>
            </div>
            
            <div class="p-6">
              <div class="flex justify-between items-center mb-6">
                <div>
                  <p class="text-secondary-600">Card Number</p>
                  <p id="display-card-number" class="text-secondary-800 font-medium"></p>
                </div>
                <div>
                  <p class="text-secondary-600">Initial Balance</p>
                  <p id="initial-balance" class="text-secondary-800 font-medium"></p>
                </div>
              </div>
              
              <div class="flex justify-between items-center mb-6 py-4 border-y border-secondary-200">
                <h4 class="text-xl font-display font-semibold text-secondary-800">Current Balance</h4>
                <p id="current-balance" class="text-2xl font-bold text-success-700"></p>
              </div>
              
              <div class="mt-8">
                <h4 class="font-display text-lg font-semibold text-secondary-800 mb-4">Transaction History</h4>
                
                <div class="overflow-hidden rounded-lg border border-secondary-200">
                  <table class="min-w-full divide-y divide-secondary-200">
                    <thead class="bg-secondary-50">
                      <tr>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-secondary-500 uppercase tracking-wider">Date</th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-secondary-500 uppercase tracking-wider">Location</th>
                        <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-secondary-500 uppercase tracking-wider">Amount</th>
                      </tr>
                    </thead>
                    <tbody id="transaction-history" class="bg-white divide-y divide-secondary-200">
                      <!-- Transaction rows will be inserted here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 bg-secondary-50">
    <div class="container mx-auto px-4 flex flex-col items-center"> {/* Centering container */}
      <div class="text-center mb-12 w-full max-w-3xl"> {/* Title block centered */}
        <h2 class="font-display text-3xl font-bold text-secondary-800 mb-4">Gift Card FAQs</h2>
      </div>

      <div class="max-w-3xl w-full space-y-4"> {/* FAQ items container centered */}
        <div class="border border-secondary-200 rounded-lg overflow-hidden">
          <button 
            class="faq-toggle w-full flex justify-between items-center p-4 text-left bg-white hover:bg-secondary-50 transition-colors"
            aria-expanded="false"
          >
            <span class="font-medium text-secondary-800">Where can I use my Anejo gift card?</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-secondary-600 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="faq-content hidden p-4 border-t border-secondary-200">
            <p class="text-secondary-700">
              Anejo gift cards can be used at any Anejo restaurant location across Canada. They cannot be used at other restaurant chains or establishments.
            </p>
          </div>
        </div>
        
        <div class="border border-secondary-200 rounded-lg overflow-hidden">
          <button 
            class="faq-toggle w-full flex justify-between items-center p-4 text-left bg-white hover:bg-secondary-50 transition-colors"
            aria-expanded="false"
          >
            <span class="font-medium text-secondary-800">Do Anejo gift cards expire?</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-secondary-600 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="faq-content hidden p-4 border-t border-secondary-200">
            <p class="text-secondary-700">
              No, Anejo gift cards never expire. Your balance will remain available for use indefinitely.
            </p>
          </div>
        </div>
        
        <div class="border border-secondary-200 rounded-lg overflow-hidden">
          <button 
            class="faq-toggle w-full flex justify-between items-center p-4 text-left bg-white hover:bg-secondary-50 transition-colors"
            aria-expanded="false"
          >
            <span class="font-medium text-secondary-800">What if my gift card is lost or stolen?</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-secondary-600 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="faq-content hidden p-4 border-t border-secondary-200">
            <p class="text-secondary-700">
              If you have your gift card number, we recommend checking your balance and contacting our customer support team immediately. If you have proof of purchase, we may be able to issue a replacement card. Please note that gift cards are treated like cash, and Anejo is not responsible for lost or stolen cards.
            </p>
          </div>
        </div>
        
        <div class="border border-secondary-200 rounded-lg overflow-hidden">
          <button 
            class="faq-toggle w-full flex justify-between items-center p-4 text-left bg-white hover:bg-secondary-50 transition-colors"
            aria-expanded="false"
          >
            <span class="font-medium text-secondary-800">Can I add more funds to my existing gift card?</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-secondary-600 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="faq-content hidden p-4 border-t border-secondary-200">
            <p class="text-secondary-700">
              Yes, you can reload your gift card at any Anejo restaurant location. Simply present your card to your server and specify the amount you'd like to add.
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>

<script>
  // FAQ toggle functionality
  const faqToggles = document.querySelectorAll('.faq-toggle');
  
  faqToggles.forEach(toggle => {
    toggle.addEventListener('click', () => {
      const content = toggle.nextElementSibling as HTMLElement | null;
      const icon = toggle.querySelector('svg');
      
      // Toggle aria-expanded
      const isCurrentlyExpanded = toggle.getAttribute('aria-expanded') === 'true';
      const newExpandedState = !isCurrentlyExpanded;
      toggle.setAttribute('aria-expanded', String(newExpandedState)); // Explicitly use String()
      
      // Toggle content visibility
      if (content) {
        content.classList.toggle('hidden');
      }
      
      // Rotate icon based on the new state
      if (icon) {
        if (newExpandedState) {
          icon.classList.add('rotate-180');
        } else {
          icon.classList.remove('rotate-180');
        }
      }
    });
  });

  // Balance checker simulation
  const balanceForm = document.getElementById('balance-form') as HTMLFormElement | null;
  const balanceResults = document.getElementById('balance-results') as HTMLElement | null;
  const displayCardNumber = document.getElementById('display-card-number') as HTMLElement | null;
  const initialBalance = document.getElementById('initial-balance') as HTMLElement | null;
  const currentBalance = document.getElementById('current-balance') as HTMLElement | null;
  const transactionHistory = document.getElementById('transaction-history') as HTMLElement | null;
  const cardNumberInput = document.getElementById('card-number') as HTMLInputElement | null;

  if (balanceForm && cardNumberInput) {
    balanceForm.addEventListener('submit', (e: Event) => {
      e.preventDefault();
      
      const cardNumber = cardNumberInput.value;
      
      // Display masked card number
      if (displayCardNumber) {
        displayCardNumber.textContent = `**** **** **** ${cardNumber.slice(-4)}`;
      }
      
      // For demo purposes, generate random balance and transaction data
      const initialBalanceAmount = Math.floor(Math.random() * 20) * 10 + 100; // Random between $100-$290
      const transactionCount = Math.floor(Math.random() * 4); // 0-3 transactions
      
      let remainingBalance = initialBalanceAmount;
      let transactionsHTML = '';
      
      const locations = ['Toronto', 'Calgary', 'Edmonton', 'Vancouver'];
      
      // Generate random transactions
      for (let i = 0; i < transactionCount; i++) {
        const date = new Date();
        date.setDate(date.getDate() - Math.floor(Math.random() * 60)); // Random date within last 60 days
        
        const amount = Math.floor(Math.random() * 10) * 5 + 20; // Random between $20-$65
        remainingBalance -= amount;
        
        const location = locations[Math.floor(Math.random() * locations.length)];
        
        transactionsHTML += `
          <tr>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-secondary-700">${date.toLocaleDateString()}</td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-secondary-700">Anejo ${location}</td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-secondary-700 text-right">-$${amount.toFixed(2)}</td>
          </tr>
        `;
      }
      
      // If no transactions, show message
      if (transactionCount === 0) {
        transactionsHTML = `
          <tr>
            <td colspan="3" class="px-4 py-4 text-center text-secondary-500">No transactions found</td>
          </tr>
        `;
      }
      
      // Update balance displays
      if (initialBalance) initialBalance.textContent = `$${initialBalanceAmount.toFixed(2)}`;
      if (currentBalance) currentBalance.textContent = `$${remainingBalance.toFixed(2)}`;
      if (transactionHistory) transactionHistory.innerHTML = transactionsHTML;
      
      // Show results
      if (balanceResults) balanceResults.classList.remove('hidden');
    });
  }
</script>